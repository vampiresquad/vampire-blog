<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Vampire's Media Hub - Search</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div id="reading-progress"></div>
  <header class="site-header">
    <div class="container nav-container">
      <a class="logo" href="index.html">Vampire<span>'s</span> Hub</a>
      <nav class="main-nav"><a href="index.html">Home</a><a href="search.html" class="active">Search</a><a href="about.html">About</a></nav>
    </div>
  </header>

  <main class="container">
    <section class="page-header"><h1>Search Posts</h1></section>
    <div style="text-align:center;margin:16px 0">
      <input id="search-input" placeholder="Type to search title, body or label..." style="width:80%;padding:12px;border-radius:10px;border:1px solid var(--border);background:var(--card);color:var(--text)">
    </div>
    <section class="post-grid" id="results">
      <article class="skeleton-card"><div class="skeleton-card-content"><div class="skeleton-line h-20 skeleton"></div></div></article>
      <article class="skeleton-card"><div class="skeleton-card-content"><div class="skeleton-line h-20 skeleton"></div></div></article>
    </section>
  </main>

  <footer class="site-footer"><p>&copy; 2025 Vampire's Media Hub</p></footer>

<script>
(async function(){
  const GITHUB_USERNAME='vampiresquad';
  const GITHUB_REPONAME='vampire-blog';
  const results = document.getElementById('results');
  const input = document.getElementById('search-input');
  let posts=[];

  async function load(){
    try{
      const res = await fetch(`https://api.github.com/repos/${GITHUB_USERNAME}/${GITHUB_REPONAME}/issues?state=open&per_page=100`);
      const data = await res.json();
      posts = Array.isArray(data) ? data : [];
      render(posts);
    }catch(e){ console.error(e); results.innerHTML = '<p style="grid-column:1/-1;text-align:center;color:#ff6b6b">Failed to load posts.</p>' }
  }

  function render(list){
    if(!list || list.length===0){ results.innerHTML = '<p style="grid-column:1/-1;text-align:center">No posts found.</p>'; return; }
    results.innerHTML = '';
    list.forEach(post=>{
      const date = new Date(post.created_at).toLocaleDateString('en-US',{year:'numeric',month:'short',day:'numeric'});
      const snippet = (post.body||'').slice(0,140).replace(/\n/g,' ') + '...';
      let tags='';
      (post.labels||[]).forEach(l=>{ if(!['bug','documentation','duplicate','enhancement','good first issue','help wanted','invalid','question','wontfix'].includes(l.name.toLowerCase())) tags += `<span class="post-tag">${l.name}</span>`});
      const el = document.createElement('div');
      el.innerHTML = `<article class="post-card fade-in"><div class="post-card-content"><h2><a href="post.html?id=${post.number}">${post.title}</a></h2><div class="post-meta">${date} • ${post.user.login}</div><div class="post-tags">${tags}</div><p class="post-excerpt">${snippet}</p><a class="read-more" href="post.html?id=${post.number}">Read More →</a></div></article>`;
      results.appendChild(el.firstElementChild);
    });
  }

  input.addEventListener('input', ()=> {
    const q = input.value.trim().toLowerCase();
    if(!q) return render(posts);
    const filtered = posts.filter(p=>{
      const txt = (p.title + ' ' + (p.body||'') + ' ' + (p.labels||[]).map(l=>l.name).join(' ')).toLowerCase();
      return txt.includes(q);
    });
    render(filtered);
  });

  // progress
  window.addEventListener('scroll', ()=> {
    const total = document.body.scrollHeight - window.innerHeight;
    const pct = (window.scrollY/total)*100;
    document.getElementById('reading-progress').style.width = pct + '%';
  });

  load();
})();
</script>
</body>
</html>
