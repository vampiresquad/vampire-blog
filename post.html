<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vampire's Media Hub - Post</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <!-- Reading Progress Bar -->
    <div id="reading-progress"></div>

    <!-- Header -->
    <header class="site-header">
        <div class="nav-container">
            <a href="index.html" class="logo">Vampire<span>'s</span> Hub</a>
            <nav class="main-nav">
                <a href="index.html">Home</a>
                <a href="about.html">About</a>
                <a href="search.html">Search</a>
            </nav>
        </div>
    </header>

    <!-- Main Container -->
    <main class="container">
        <section class="page-header">
            <h1 id="post-title">Loading...</h1>
        </section>

        <section id="post-content" class="post-grid">
            <article class="skeleton-card">
                <div class="skeleton-card-content">
                    <div class="skeleton skeleton-line h-20"></div>
                    <div class="skeleton skeleton-line h-12"></div>
                    <div class="skeleton skeleton-line h-16"></div>
                    <div class="skeleton skeleton-line h-16-75"></div>
                    <div class="skeleton skeleton-line h-16-50" style="margin-top:1rem;"></div>
                </div>
            </article>
        </section>
    </main>

    <!-- Footer -->
    <footer class="site-footer">
        <p>&copy; 2025 - Vampire's Media Hub. All rights reserved.</p>
    </footer>

    <!-- JS -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const GITHUB_USERNAME = 'vampiresquad';
            const GITHUB_REPONAME = 'vampire-blog';
            const postContainer = document.getElementById('post-content');
            const postTitle = document.getElementById('post-title');
            const progressBar = document.getElementById('reading-progress');

            // --- Get Issue ID from URL ---
            const params = new URLSearchParams(window.location.search);
            const postId = params.get('id');
            if(!postId){
                postContainer.innerHTML = `<p style="grid-column:1/-1;text-align:center;">No post ID provided!</p>`;
                return;
            }

            // --- Fetch Single Post ---
            async function fetchPost() {
                const apiUrl = `https://api.github.com/repos/${GITHUB_USERNAME}/${GITHUB_REPONAME}/issues/${postId}`;
                try {
                    const response = await fetch(apiUrl);
                    if(!response.ok) throw new Error(`${response.status} ${response.statusText}`);
                    const post = await response.json();

                    // Set Title
                    postTitle.textContent = post.title;

                    // Post Date & Author
                    const postDate = new Date(post.created_at).toLocaleDateString('en-US', {
                        year:'numeric', month:'long', day:'numeric'
                    });
                    const metaHTML = `<div class="post-meta">Posted by ${post.user.login} on ${postDate}</div>`;

                    // Tags
                    let tagsHTML = '';
                    post.labels.forEach(label=>{
                        const exclude = ['bug','documentation','duplicate','enhancement','good first issue','help wanted','invalid','question','wontfix'];
                        if(!exclude.includes(label.name.toLowerCase())){
                            tagsHTML += `<span class="post-tag" style="background-color:#${label.color}30;color:#${label.color};">${label.name}</span>`;
                        }
                    });
                    tagsHTML = `<div class="post-tags">${tagsHTML}</div>`;

                    // Body Content
                    let bodyHTML = `<div class="post-body">${post.body.replace(/\n/g,'<br>')}</div>`;

                    // Check for Tutorial Quiz
                    if(post.labels.some(l=>l.name.toLowerCase()==='tutorial')){
                        const quizHTML = parseQuiz(post.body);
                        bodyHTML += quizHTML;
                    }

                    // Render Post
                    postContainer.innerHTML = `
                        <article class="post-card fade-in">
                            <div class="post-card-content">
                                ${metaHTML}
                                ${tagsHTML}
                                ${bodyHTML}
                            </div>
                        </article>
                    `;

                } catch(err){
                    console.error('Error fetching post:', err);
                    postContainer.innerHTML = `<p style="text-align:center;color:#ff4d4d;grid-column:1/-1;">Failed to load post. ${err.message}</p>`;
                }
            }

            // --- Parse Quiz --- 
            function parseQuiz(body){
                const quizStart = body.indexOf('---QUIZ---');
                const quizEnd = body.indexOf('---ENDQUIZ---');
                if(quizStart===-1 || quizEnd===-1) return '';
                const quizContent = body.substring(quizStart + 10, quizEnd).trim();
                const lines = quizContent.split('\n').filter(l=>l.trim()!=='');
                let html = `<div class="quiz-container"><h3>Quiz</h3>`;
                lines.forEach((line,i)=>{
                    const [q,a] = line.split('||'); // Format: Question||Answer
                    if(q && a){
                        html += `
                        <div class="quiz-question">
                            <p>${i+1}. ${q.trim()}</p>
                            <input type="text" class="quiz-input" data-answer="${a.trim()}">
                            <button class="quiz-check">Check</button>
                            <span class="quiz-result"></span>
                        </div>`;
                    }
                });
                html += `</div>`;
                return html;
            }

            // --- Quiz Event Listener ---
            document.addEventListener('click', e=>{
                if(e.target.classList.contains('quiz-check')){
                    const container = e.target.closest('.quiz-question');
                    const input = container.querySelector('.quiz-input');
                    const result = container.querySelector('.quiz-result');
                    if(input.value.trim().toLowerCase() === input.dataset.answer.toLowerCase()){
                        result.textContent = '✅ Correct!';
                        result.style.color = 'var(--primary-color)';
                    } else {
                        result.textContent = '❌ Wrong!';
                        result.style.color = '#ff4d4d';
                    }
                }
            });

            // --- Reading Progress ---
            window.addEventListener('scroll', ()=>{
                const scrollTop = window.scrollY;
                const docHeight = document.body.scrollHeight - window.innerHeight;
                const scrolled = (scrollTop / docHeight) * 100;
                progressBar.style.width = scrolled + "%";
            });

            // --- Init ---
            fetchPost();
        });
    </script>

    <style>
        /* Quiz Styles */
        .quiz-container{
            background: var(--card-background);
            border:1px solid var(--border-color);
            padding:1.5rem;
            margin-top:1.5rem;
            border-radius: var(--border-radius);
        }
        .quiz-question{
            margin-bottom:1rem;
        }
        .quiz-input{
            padding:0.5rem;
            width:70%;
            margin-right:0.5rem;
            border-radius:6px;
            border:1px solid var(--border-color);
            background-color: var(--background-color);
            color: var(--text-color);
        }
        .quiz-check{
            padding:0.5rem 1rem;
            border:none;
            background: var(--primary-color);
            color:#0d1117;
            font-weight:600;
            border-radius:6px;
            cursor:pointer;
        }
        .quiz-check:hover{
            background: var(--secondary-color);
        }
        .quiz-result{
            margin-left:1rem;
            font-weight:600;
        }

        /* Fade-in Animation */
        .fade-in{ animation: fadeInUp 0.6s ease forwards; opacity:0; }
        @keyframes fadeInUp{
            from{ transform: translateY(20px); opacity:0; }
            to{ transform: translateY(0); opacity:1; }
        }
    </style>

</body>
</html>
